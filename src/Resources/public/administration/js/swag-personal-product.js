(this.webpackJsonp=this.webpackJsonp||[]).push([["swag-personal-product"],{"0tPg":function(t,e){t.exports='{% block sw_product_detail_base_basic_info_card %}\n    <sw-card title="Product customizer attributes" :isLoading="isLoading">\n        <personal-product-canvas></personal-product-canvas>\n    </sw-card>\n    {% parent() %}\n{% endblock %}\n'},"9i1t":function(t,e){t.exports='{% block personal_product_preview_modal %}\n    <sw-modal title="Preview" variant="large" class="personal-product-preview-modal" @modal-close="$emit(\'modal-close\')">\n        <template v-if="product">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n                    <canvas ref="canvas" class="canvas"></canvas>\n                </div>\n            </div>\n        </template>\n    </sw-modal>\n{% endblock %}\n'},"9jNY":function(t,e,s){},GiZG:function(t,e,s){var a=s("l/En");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s("SZ7m").default)("0738a082",a,!0,{})},Ww5d:function(t,e,s){var a=s("9jNY");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,s("SZ7m").default)("006e41e7",a,!0,{})},hVFK:function(t,e){t.exports='{% block personal_product_attributes %}\n    <div v-if="!isLoading" class="personal-product-canvas">\n        <sw-switch-field\n            label="Customizable product"\n            v-model="isCustomizable">\n        </sw-switch-field>\n\n        <sw-container columns="2fr 1fr" v-if="isCustomizable">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n                    <canvas ref="canvas" class="canvas" @click="onClickCanvas"></canvas>\n                </div>\n            </div>\n\n            <div>\n                <sw-number-field\n                    label="Canvas X0"\n                    v-model="canvasX0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Y0"\n                    v-model="canvasY0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canva Width"\n                    v-model="canvasWidth">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Height"\n                    v-model="canvasHeight">\n                </sw-number-field>\n\n                <sw-button @click="onClickReset" variant="primary">\n                    Reset\n                </sw-button>\n            </div>\n        </sw-container>\n    </div>\n{% endblock %}\n'},joF6:function(t,e,s){"use strict";s.r(e);var a=s("hVFK"),n=s.n(a);s("Ww5d");const{mapState:i,mapGetters:o}=Shopware.Component.getComponentHelper();Shopware.Component.register("personal-product-canvas",{template:n.a,data:()=>({setPosKey:0}),computed:{...i("swProductDetail",["product"]),...o("swProductDetail",["isLoading"]),isCustomizable:{get(){return this.product.customFields.personal_product_customizable||!1},set(t){this.$set(this.product.customFields,"personal_product_customizable",t),t&&this.initializeCanvas()}},canvasX0:{get(){return this.get("X0")},set(t){this.set(t,"X0")}},canvasX1:{get(){return this.get("X1")},set(t){this.set(t,"X1")}},canvasY0:{get(){return this.get("Y0")},set(t){this.set(t,"Y0")}},canvasY1:{get(){return this.get("Y1")},set(t){this.set(t,"Y1")}},canvasWidth:{get(){return this.canvasX1-this.canvasX0||0},set(t){this.canvasX1=this.canvasX0+t}},canvasHeight:{get(){return this.canvasY1-this.canvasY0||0},set(t){this.canvasY1=this.canvasY0+t}}},watch:{isLoading(t){!t&&this.isCustomizable&&this.initializeCanvas()}},methods:{get(t){return this.product.customFields[`personal_product_canvas${t}`]||0},set(t,e){this.$set(this.product.customFields,`personal_product_canvas${e}`,t),this.updateCanvasRect()},initializeCanvas(){this.$nextTick(()=>{const t=this.product.media.first().media.metaData;this.$refs.canvas.width=t.width,this.$refs.canvas.height=t.height,this.updateCanvasRect()})},onClickCanvas(t){const e=this.$refs.canvas.getBoundingClientRect(),s=t.clientX-e.left,a=t.clientY-e.top,n=this.$refs.canvas.offsetWidth,i=this.$refs.canvas.offsetHeight,o=this.$refs.canvas.width/n,r=this.$refs.canvas.height/i;this.setPosition(s*o,a*r)},setPosition(t,e){this[`canvasX${this.setPosKey}`]=Math.ceil(t),this[`canvasY${this.setPosKey}`]=Math.ceil(e),this.setPosKey=+!this.setPosKey},updateCanvasRect(){const t=this.$refs.canvas.getContext("2d");t.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);const e=new Image;e.onload=()=>{t.drawImage(e,0,0),t.fillStyle="rgba(69,55,194,0.4)",t.fillRect(this.canvasX0,this.canvasY0,this.canvasX1-this.canvasX0,this.canvasY1-this.canvasY0)},e.src=this.product.media.first().media.url},onClickReset(){this.canvasX0=0,this.canvasX1=0,this.canvasY0=0,this.canvasY1=0,this.setPosKey=0,this.updateCanvasRect()}}});var r=s("0tPg"),c=s.n(r);const{Component:d}=Shopware;d.override("sw-product-detail-base",{template:c.a});var l=s("qhWN"),p=s.n(l);const{Component:u}=Shopware;u.override("sw-order-line-items-grid",{template:p.a,data:()=>({personalProduct:!1})});var h=s("9i1t"),v=s.n(h);s("GiZG");const{Component:m,Context:w}=Shopware,{Criteria:f}=Shopware.Data;m.register("personal-product-preview-modal",{template:v.a,inject:["repositoryFactory"],props:{productId:{required:!0,type:String},imageUrl:{required:!0,type:String}},data:()=>({product:null}),computed:{productRepository(){return this.repositoryFactory.create("product")}},created(){this.createdComponent()},methods:{createdComponent(){const t=new f;t.setIds([this.productId]),t.addAssociation("media"),this.productRepository.search(t,w.api).then(t=>{this.product=t.first(),this.$nextTick(()=>this.drawCanvas())})},drawCanvas(){const t=this.product.media.first().media.metaData;this.$refs.canvas.width=t.width,this.$refs.canvas.height=t.height;const e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);const s=this.product.customFields,a=new Image,n=new Image;a.onload=()=>{e.drawImage(a,0,0),n.src=this.imageUrl},n.onload=()=>{e.drawImage(n,s.personal_product_canvasX0,s.personal_product_canvasY0,s.personal_product_canvasX1-s.personal_product_canvasX0,s.personal_product_canvasY1-s.personal_product_canvasY0)},a.src=this.product.media.first().media.url}}})},"l/En":function(t,e,s){},qhWN:function(t,e){t.exports='{% block sw_order_line_items_grid_grid_columns_label_content %}\n    {% parent() %}\n    <span v-if="item.payload.url">&nbsp;- Customized</span>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid_columns_label_link %}\n    <router-link v-else-if="!isInlineEdit && item.payload.url"\n                 :title="$tc(\'sw-order.detailBase.contextMenuShowProduct\')"\n                 :to="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ item.label }}\n    </router-link>\n    {% parent() %}\n{% endblock %}\n\n\n{% block sw_order_line_items_grid_grid_actions_show %}\n    <template v-if="item.payload.url">\n        <sw-context-menu-item :disabled="item.type !== \'product\'"\n                              icon="default-eye-open"\n                              :routerLink="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ $tc(\'sw-order.detailBase.contextMenuShowProduct\') }}\n        </sw-context-menu-item>\n        <sw-context-menu-item icon="default-eye-open" @click="personalProduct = item">\n            Show preview\n        </sw-context-menu-item>\n    </template>\n    <template v-else>\n        {% parent() %}\n    </template>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid %}\n    {% parent() %}\n\n    <personal-product-preview-modal v-if="personalProduct"\n                                    :productId="personalProduct.referencedId"\n                                    :imageUrl="personalProduct.payload.url"\n                                    @modal-close="personalProduct = false">\n    </personal-product-preview-modal>\n{% endblock %}\n'}},[["joF6","runtime","vendors-node"]]]);