(this.webpackJsonp=this.webpackJsonp||[]).push([["swag-personal-product"],{"1Zok":function(e,t){e.exports='{#{% block sw_product_detail_attribute_sets %}#}\n{% block sw_product_detail_base_basic_info_card %}\n    <sw-card title="Product customizer attributes" :isLoading="isLoading">\n        <personal-product-canvas></personal-product-canvas>\n    </sw-card>\n    {% parent() %}\n{% endblock %}\n'},Ke6e:function(e,t,s){"use strict";s.r(t);var n=s("Rh5E"),a=s.n(n);s("x/LB");const{mapState:o,mapGetters:i}=Shopware.Component.getComponentHelper(),{get:r}=Shopware.Utils;Shopware.Component.register("personal-product-canvas",{template:a.a,data:()=>({setPosKey:0}),computed:{...o("swProductDetail",["product"]),...i("swProductDetail",["isLoading"]),isCustomizable:{get(){return this.product.customFields.personal_product_customizable||!1},set(e){this.$set(this.product.customFields,"personal_product_customizable",e),e&&this.initializeCanvas()}}},created(){},watch:{isLoading(e){!e&&this.isCustomizable&&this.initializeCanvas()}},methods:{initializeCanvas(){this.$nextTick(()=>{const e=this.product.media.first().media.metaData;this.$refs.canvas.width=e.width,this.$refs.canvas.height=e.height,this.updateCanvasRect()})},setCustomField(e,t,s){this.$set(this.product.customFields,`personal_product_canvasX${s}`,e),this.$set(this.product.customFields,`personal_product_canvasY${s}`,t)},onClickCanvas(e){const t=this.$refs.canvas.getBoundingClientRect(),s=e.clientX-t.left,n=e.clientY-t.top,a=this.$refs.canvas.offsetWidth,o=this.$refs.canvas.offsetHeight,i=this.$refs.canvas.width/a,r=this.$refs.canvas.height/o;this.setPosition(s*i,n*r)},setPosition(e,t){console.log("x,y,this.setPosKey : ",e,t,this.setPosKey),this.setCustomField(Math.ceil(e),Math.ceil(t),this.setPosKey),this.setPosKey=+!this.setPosKey,this.updateCanvasRect()},updateCanvasRect(){const e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);const t=new Image;t.src=this.product.media.first().media.url,t.onload=()=>{e.drawImage(t,0,0),e.fillStyle="rgba(69,55,194,0.4)",e.fillRect(this.product.customFields.personal_product_canvasX0,this.product.customFields.personal_product_canvasY0,this.product.customFields.personal_product_canvasX1-this.product.customFields.personal_product_canvasX0,this.product.customFields.personal_product_canvasY1-this.product.customFields.personal_product_canvasY0)}},onClickReset(){this.setCustomField(0,0,0),this.setCustomField(0,0,1),this.updateCanvasRect()}}});var c=s("1Zok"),d=s.n(c);const{Component:l}=Shopware;l.override("sw-product-detail-base",{template:d.a});var p=s("xWcj"),u=s.n(p);const{Component:m}=Shopware;m.override("sw-order-line-items-grid",{template:u.a,data:()=>({personalProduct:!1})});var v=s("fHNS"),h=s.n(v);const{Criteria:_}=Shopware.Data;Shopware.Component.register("personal-product-preview-modal",{template:h.a,inject:["repositoryFactory","apiContext"],props:{productId:{required:!0,type:String},imageUrl:{required:!0,type:String}},data:()=>({product:null}),computed:{productRepository(){return this.repositoryFactory.create("product")}},created(){this.createdComponent()},methods:{createdComponent(){const e=new _;e.setIds([this.productId]),e.addAssociation("media"),this.productRepository.search(e,this.apiContext).then(e=>{this.product=e[0],this.$nextTick(()=>this.drawCanvas())})},drawCanvas(){const e=this.product.media.first().media.metaData;this.$refs.canvas.width=e.width,this.$refs.canvas.height=e.height;const t=this.$refs.canvas.getContext("2d");t.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);const s=this.product.customFields,n=new Image,a=new Image;n.onload=()=>{t.drawImage(n,0,0),a.src=this.imageUrl},a.onload=()=>{t.drawImage(a,s.personal_product_canvasX0,s.personal_product_canvasY0,s.personal_product_canvasX1-s.personal_product_canvasX0,s.personal_product_canvasY1-s.personal_product_canvasY0)},n.src=this.product.media.first().media.url}}})},"Ly1/":function(e,t,s){},Rh5E:function(e,t){e.exports='{% block personal_product_attributes %}\n    <div v-if="!isLoading" class="personal-product-canvas">\n        <sw-switch-field\n            label="Product can be customized"\n            v-model="isCustomizable">\n        </sw-switch-field>\n\n        <sw-container columns="2fr 1fr" v-if="isCustomizable || false">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n{#                    <img :src="product.media.first().media.url" class="cover">#}\n                    <canvas ref="canvas" class="canvas" @click="onClickCanvas"></canvas>\n                </div>\n            </div>\n\n            <div>\n                <sw-number-field\n                    label="Canvas X0"\n                    v-model="product.customFields.personal_product_canvasX0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Y0"\n                    v-model="product.customFields.personal_product_canvasY0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas X1"\n                    v-model="product.customFields.personal_product_canvasX1">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Y1"\n                    v-model="product.customFields.personal_product_canvasY1">\n                </sw-number-field>\n\n                <sw-button @click="onClickReset" variant="primary">\n                    Reset\n                </sw-button>\n            </div>\n        </sw-container>\n\n\n\n\n    </div>\n{% endblock %}\n'},fHNS:function(e,t){e.exports='{% block personal_product_preview_modal %}\n    <sw-modal title="Preview" variant="large" class="personal-product-preview-modal" @modal-close="$emit(\'modal-close\')">\n        <template v-if="product">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n                    <canvas ref="canvas" class="canvas"></canvas>\n                </div>\n            </div>\n        </template>\n    </sw-modal>\n{% endblock %}\n'},"x/LB":function(e,t,s){var n=s("Ly1/");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,s("SZ7m").default)("1f687062",n,!0,{})},xWcj:function(e,t){e.exports='{% block sw_order_line_items_grid_grid_columns_label_content %}\n    {% parent() %}\n    <span v-if="item.payload.url">&nbsp;- Customized</span>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid_columns_label_link %}\n    <router-link v-else-if="!isInlineEdit && item.payload.url"\n                 :title="$tc(\'sw-order.detailBase.contextMenuShowProduct\')"\n                 :to="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ item.label }}\n    </router-link>\n    {% parent() %}\n{% endblock %}\n\n\n{% block sw_order_line_items_grid_grid_actions_show %}\n    <template v-if="item.payload.url">\n        <sw-context-menu-item :disabled="item.type !== \'product\'"\n                              icon="default-eye-open"\n                              :routerLink="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ $tc(\'sw-order.detailBase.contextMenuShowProduct\') }}\n        </sw-context-menu-item>\n        <sw-context-menu-item icon="default-eye-open" @click="personalProduct = item">\n            Show preview\n        </sw-context-menu-item>\n    </template>\n    <template v-else>\n        {% parent() %}\n    </template>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid %}\n    {% parent() %}\n\n    <personal-product-preview-modal v-if="personalProduct"\n                                    :productId="personalProduct.referencedId"\n                                    :imageUrl="personalProduct.payload.url"\n                                    @modal-close="personalProduct = false">\n    </personal-product-preview-modal>\n{% endblock %}\n'}},[["Ke6e","runtime","vendors-node"]]]);